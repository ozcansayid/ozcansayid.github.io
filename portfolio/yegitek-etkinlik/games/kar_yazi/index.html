<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kar ÃœstÃ¼ne YazÄ± Yaz</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Kid Theme -->
    <link rel="stylesheet" href="../../assets/css/style.css">
    <!-- Confetti Library for Rewards -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* Specific styles for this game */
        body {
            overflow: hidden;
            /* Fix overflow issues */
            background-color: #87CEEB;
            /* Sky blue background for contrast behind snow */
        }

        .snow-canvas-container {
            width: 100%;
            height: 100%;
            background-color: #fcfcfc;
            /* Snow white */
            background-image:
                radial-gradient(circle at 10% 20%, rgb(255, 255, 255) 0%, rgb(240, 248, 255) 90%),
                url('https://www.transparenttextures.com/patterns/snow.png');
            /* Add texture */
            position: relative;
            overflow: hidden;
            border-radius: 1rem;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.1);
            cursor: none;
            /* Hide default cursor */
        }

        #snowCanvas {
            display: block;
            width: 100%;
            height: 100%;
            touch-action: none;
            position: relative;
            z-index: 10;
        }

        /* Snowflake animation */
        .snowflake {
            position: absolute;
            color: #fff;
            font-size: 1em;
            font-family: Arial;
            text-shadow: 0 0 1px #000;
            top: -10%;
            z-index: 5;
            user-select: none;
            pointer-events: none;
            animation-name: snowflakes-fall, snowflakes-shake;
            animation-duration: 10s, 3s;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: infinite, infinite;
            animation-play-state: running, running;
        }

        @keyframes snowflakes-fall {
            0% {
                top: -10%;
            }

            100% {
                top: 100%;
            }
        }

        @keyframes snowflakes-shake {
            0% {
                transform: translateX(0px);
            }

            50% {
                transform: translateX(80px);
            }

            100% {
                transform: translateX(0px);
            }
        }

        /* Tool Cursor */
        #toolCursor {
            position: absolute;
            pointer-events: none;
            z-index: 100;
            transform: translate(-50%, -50%);
            /* Center the tool on cursor */
            font-size: 3rem;
            filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.3));
        }

        /* Update header title color to be bluish/cold for snow theme? Or stick to kid theme. */
    </style>
</head>

<body>

    <div class="game-container-fixed">

        <!-- Sidebar (Left) -->
        <div class="sidebar-kid">

            <!-- Top: Tool Selection Container -->
            <div class="tools-container d-flex flex-column gap-3 w-100 align-items-center"
                style="background-color: transparent; padding: 15px 5px;">

                <!-- Charcoal Selector -->
                <button id="btnCharcoal" class="btn btn-kid active-tool p-0"
                    style="width: 100px; height: 100px; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"
                    onclick="setTool('charcoal')">
                    <!-- Charcoal SVG Icon -->
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                        style="margin-bottom: 2px;">
                        <path
                            d="M19.07 4.93L17.07 2.93C16.68 2.54 16.05 2.54 15.66 2.93L3.93 14.66C3.54 15.05 3.54 15.68 3.93 16.07L5.93 18.07C6.32 18.46 6.95 18.46 7.34 18.07L19.07 6.34C19.46 5.95 19.46 5.32 19.07 4.93Z"
                            fill="#333" />
                        <path
                            d="M15.66 2.93L3.93 14.66C3.54 15.05 3.54 15.68 3.93 16.07L5.93 18.07C6.32 18.46 6.95 18.46 7.34 18.07L19.07 6.34C19.46 5.95 19.46 5.32 19.07 4.93L17.07 2.93C16.68 2.54 16.05 2.54 15.66 2.93Z"
                            stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <span style="font-size: 0.8rem; font-weight: bold; color: #333;">KÃ¶mÃ¼r</span>
                </button>

                <!-- Glove Selector -->
                <button id="btnEraser" class="btn btn-kid p-0"
                    style="width: 100px; height: 100px; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"
                    onclick="setTool('eraser')">
                    <!-- Glove SVG Icon -->
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                        style="margin-bottom: 2px;">
                        <path
                            d="M18 16V10H16V6C16 4.89543 15.1046 4 14 4H12C10.8954 4 10 4.89543 10 6V10H8V8C8 6.89543 7.10457 6 6 6C4.89543 6 4 6.89543 4 8V18C4 19.1046 4.89543 20 6 20H16C17.1046 20 18 19.1046 18 18ZM18 16H20V12H18V16Z"
                            fill="#FF9F1C" />
                        <path
                            d="M18 16V10H16V6C16 4.89543 15.1046 4 14 4H12C10.8954 4 10 4.89543 10 6V10H8V8C8 6.89543 7.10457 6 6 6C4.89543 6 4 6.89543 4 8V18C4 19.1046 4.89543 20 6 20H16C17.1046 20 18 19.1046 18 18Z"
                            stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M18 16H20V12H18V16Z" stroke="#333" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                    <span style="font-size: 0.8rem; font-weight: bold; color: #333;">Eldiven</span>
                </button>
            </div>

            <!-- Bottom: Navigation Buttons -->
            <div class="nav-buttons-container">

                <!-- Instructions Button -->
                <button class="btn btn-kid btn-info-kid btn-icon-only" data-bs-toggle="modal"
                    data-bs-target="#instructionsModal" title="YÃ¶nerge">
                    <i class="bi bi-question-lg"></i>
                </button>

                <!-- Reload/Retry Button (Clears the canvas) -->
                <button onclick="clearCanvas()" class="btn btn-kid btn-primary-kid btn-icon-only" title="Hepsini Sil">
                    <i class="bi bi-trash3-fill"></i>
                </button>

                <!-- Home Button -->
                <a href="../../index.html" class="btn btn-kid btn-danger btn-icon-only" title="Anasayfa">
                    <i class="bi bi-house-fill"></i>
                </a>
            </div>

        </div>

        <!-- Main Content (Right) -->
        <div class="main-content-kid">

            <!-- New Top Header -->
            <div class="game-header">
                <h2 class="game-title">Kar ÃœstÃ¼ne YazÄ± Yaz</h2>
                <div class="game-nav">
                    <!-- Snow effect container inside logic -->
                </div>
            </div>

            <!-- Inner Game Board -->
            <div class="game-board p-0" style="overflow: hidden; position: relative;">
                <div class="snow-canvas-container" id="canvasContainer">
                    <canvas id="snowCanvas"></canvas>
                    <div id="snowflakesContainer"></div>
                    <!-- Custom Cursor Element -->
                    <div id="toolCursor">ðŸª¨</div> <!-- Charcoal emoji as placeholder -->
                </div>
            </div>

        </div>

    </div>

    <!-- Instructions Modal -->
    <div class="modal fade" id="instructionsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content modal-content-kid" style="border-color: #4CC9F0;">
                <div class="modal-header">
                    <h5 class="modal-title display-6">NasÄ±l OynanÄ±r?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-5">
                    <div class="row align-items-center">
                        <div class="col-4 text-center">
                            <i class="bi bi-pencil-fill text-info" style="font-size: 6rem;"></i>
                        </div>
                        <div class="col-8 text-start">
                            <p class="lead">Karla kaplÄ± alana dilediÄŸin gibi yazÄ± yaz veya resim Ã§iz!</p>
                            <ul class="list-unstyled" style="font-size: 1.2rem;">
                                <li class="mb-2">ðŸ‘‰ <strong>KÃ¶mÃ¼r:</strong> Yazmak iÃ§in fareyi tÄ±klayÄ±p sÃ¼rÃ¼kle.</li>
                                <li class="mb-2">ðŸ‘‰ <strong>Silgi:</b> HatalarÄ± silmek iÃ§in eldiveni seÃ§.</li>
                                <li class="mb-2">ðŸ‘‰ <strong>Temizle:</strong> Ã‡Ã¶p kutusu butonuna basarak her ÅŸeyi
                                    silebilirsin.</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-kid btn-primary-kid" data-bs-dismiss="modal">AnladÄ±m</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>window.ASSETS_PATH = '../../assets/';</script>
    <script src="../../assets/js/main.js"></script> <!-- ADDED MAIN.JS FOR SCALING -->

    <script>
        // Drawing Logic
        const canvas = document.getElementById('snowCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('canvasContainer');
        const toolCursor = document.getElementById('toolCursor');
        const btnCharcoal = document.getElementById('btnCharcoal');
        const btnEraser = document.getElementById('btnEraser');

        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let currentTool = 'charcoal'; // 'charcoal' or 'eraser'

        // Snowflakes
        function createSnowflakes() {
            const snowflakesContainer = document.getElementById('snowflakesContainer');
            const numberOfSnowflakes = 50;
            const snowflakes = [];

            for (let i = 0; i < numberOfSnowflakes; i++) {
                const snowflake = document.createElement('div');
                snowflake.classList.add('snowflake');
                snowflake.textContent = 'â„';
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.fontSize = (Math.random() * 10 + 10) + 'px';
                snowflake.style.animationDuration = (Math.random() * 5 + 5) + 's';
                snowflake.style.animationDelay = (Math.random() * 5) + 's';
                snowflake.style.opacity = Math.random();
                snowflakesContainer.appendChild(snowflake);
            }
        }
        createSnowflakes();

        function resizeCanvas() {
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function setTool(tool) {
            currentTool = tool;

            // Define colors
            const activeColor = '#FFD700'; // Gold/Yellow
            const inactiveColor = '#E0E0E0'; // Light Gray
            const activeScale = 'scale(1.1)';
            const inactiveScale = 'scale(1)';

            if (tool === 'charcoal') {
                toolCursor.textContent = 'ðŸª¨'; // Rocks/Charcoal

                // Charcoal Active
                btnCharcoal.style.backgroundColor = activeColor;
                btnCharcoal.style.transform = activeScale;
                btnCharcoal.style.border = '4px solid #fff'; // Add border pop

                // Eraser Inactive
                btnEraser.style.backgroundColor = inactiveColor;
                btnEraser.style.transform = inactiveScale;
                btnEraser.style.border = 'none';

            } else {
                toolCursor.textContent = 'ðŸ§¤'; // Glove as eraser

                // Eraser Active
                btnEraser.style.backgroundColor = activeColor;
                btnEraser.style.transform = activeScale;
                btnEraser.style.border = '4px solid #fff';

                // Charcoal Inactive
                btnCharcoal.style.backgroundColor = inactiveColor;
                btnCharcoal.style.transform = inactiveScale;
                btnCharcoal.style.border = 'none';
            }
        }

        // Initialize tool state
        setTool('charcoal');

        function updateCursorPosition(e) {
            const [x, y] = getCoordinates(e);
            toolCursor.style.left = x + 'px';
            toolCursor.style.top = y + 'px';
        }

        function startDrawing(e) {
            isDrawing = true;
            [lastX, lastY] = getCoordinates(e);
            updateCursorPosition(e);
            draw(e); // Allow dotting
        }

        function draw(e) {
            updateCursorPosition(e);
            if (!isDrawing) return;

            e.preventDefault(); // Prevent scrolling on touch

            const [x, y] = getCoordinates(e);

            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);

            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            if (currentTool === 'charcoal') {
                ctx.globalCompositeOperation = 'source-over';
                ctx.strokeStyle = '#2b2b2b';
                ctx.lineWidth = 12;
                ctx.shadowBlur = 2;
                ctx.shadowColor = '#2b2b2b';
            } else {
                // Eraser
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineWidth = 40; // Bigger eraser
                ctx.shadowBlur = 0;
            }

            ctx.stroke();

            [lastX, lastY] = [x, y];
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.beginPath(); // Reset path
        }

        function getCoordinates(e) {
            const rect = canvas.getBoundingClientRect();
            let clientX, clientY;

            if (e.changedTouches && e.changedTouches.length > 0) {
                clientX = e.changedTouches[0].clientX;
                clientY = e.changedTouches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            // Calculate scale factors (internal pixels / visual pixels)
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            return [
                (clientX - rect.left) * scaleX,
                (clientY - rect.top) * scaleY
            ];
        }

        function clearCanvas() {
            ctx.globalCompositeOperation = 'destination-out'; // clear bits
            ctx.fillRect(0, 0, canvas.width, canvas.height); // clear all
            ctx.globalCompositeOperation = 'source-over'; // reset
        }

        // Event Listeners
        container.addEventListener('mousedown', startDrawing);
        container.addEventListener('mousemove', draw);
        window.addEventListener('mouseup', stopDrawing); // Catch mouse up outside

        // Touch support
        container.addEventListener('touchstart', startDrawing);
        container.addEventListener('touchmove', draw);
        window.addEventListener('touchend', stopDrawing);

    </script>
</body>

</html>